{% extends "base.html" %}
{% load my_filters %}
{% block title %}{{ "Camellia 控制台" | translate }}{% endblock %}
{% block legend_name %}{{ "综合屏" | translate }}{% endblock %}
{% block page_actions %}
{% if u.is_admin and show_all %}
<a class="btn btn-secondary" href="/api/down_peers">{{ "导出xlsx" | translate }}</a>
{% endif %}
{% endblock %}
{% block content %}
{% if not show_all %}
<section class="card">
  <div class="card-header">
    <div>
      <h2 class="card-title">{{ "设备统计" | translate }}</h2>
      <p class="card-subtitle">{{ "用户名" | translate }}: {{ u.username }}</p>
    </div>
    <span class="pill">{{ page_obj.paginator.count }} {{ "台设备" | translate }}</span>
  </div>
  <div class="card-body">
    <div class="table-wrap">
      <table class="data-table">
        <thead>
          <tr>
            <th>{{ "客户端ID" | translate }}</th>
            <th>{{ "别名" | translate }}</th>
            <th>{{ "设备组" | translate }}</th>
            <th>{{ "备注" | translate }}</th>
            <th>{{ "版本" | translate }}</th>
            <th>{{ "连接密码" | translate }}</th>
            <th>{{ "系统用户名" | translate }}</th>
            <th>{{ "计算机名" | translate }}</th>
            <th>{{ "平台" | translate }}</th>
            <th>{{ "系统" | translate }}</th>
            <th>{{ "CPU" | translate }}</th>
            <th>{{ "内存" | translate }}</th>
            <th>{{ "IP" | translate }}</th>
            <th>{{ "注册时间" | translate }}</th>
            <th>{{ "更新时间" | translate }}</th>
            <th>{{ "状态" | translate }}</th>
          </tr>
        </thead>
        <tbody>
          {% for one in page_obj %}
          <tr>
            <td>{{ one.rid }}</td>
            <td>{{ one.alias|default:"-" }}</td>
            <td>{{ one.device_group_name|default:"-" }}</td>
            <td>{{ one.note|default:"-" }}</td>
            <td>{{ one.version }}</td>
            <td>{{ one.has_rhash }}</td>
            <td>{{ one.username }}</td>
            <td>{{ one.hostname }}</td>
            <td>{{ one.platform }}</td>
            <td>{{ one.os }}</td>
            <td>{{ one.cpu }}</td>
            <td>{{ one.memory }}</td>
            <td>{{ one.ip_address }}</td>
            <td>{{ one.create_time }}</td>
            <td>{{ one.update_time }}</td>
            <td>
              <span class="status-pill {% if one.status == "在线"|translate %}is-online{% else %}is-offline{% endif %}">
                {{ one.status }}
              </span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>
<div class="pagination">
  {% if page_obj.has_previous %}
    <a class="btn btn-ghost" href="?page=1">&laquo; {{ "首页" | translate }}</a>
    <a class="btn btn-ghost" href="?page={{ page_obj.previous_page_number }}">{{ "上一页" | translate }}</a>
  {% endif %}
  {% if page_obj.paginator.num_pages > 1 %}
    <span class="page-info">{{ "页码" | translate }} {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
  {% endif %}
  {% if page_obj.has_next %}
    <a class="btn btn-ghost" href="?page={{ page_obj.next_page_number }}">{{ "下一页" | translate }}</a>
    <a class="btn btn-ghost" href="?page={{ page_obj.paginator.num_pages }}">{{ "尾页" | translate }} &raquo;</a>
  {% endif %}
</div>
{% endif %}

{% if u.is_admin and show_all %}
<section class="card">
  <div class="card-header">
    <div>
      <h2 class="card-title">{{ "全部用户" | translate }}</h2>
      <p class="card-subtitle">{{ "管理员模式" | translate }}</p>
    </div>
    <span class="pill">{{ page_obj.paginator.count }} {{ "台设备" | translate }}</span>
  </div>
  <div class="card-body">
    <div class="table-wrap">
      <table class="data-table">
        <thead>
          <tr>
            <th>{{ "客户端ID" | translate }}</th>
            <th>{{ "归属用户" | translate }}</th>
            <th>{{ "设备组" | translate }}</th>
            <th>{{ "策略" | translate }}</th>
            <th>{{ "版本" | translate }}</th>
            <th>{{ "系统用户名" | translate }}</th>
            <th>{{ "计算机名" | translate }}</th>
            <th>{{ "系统" | translate }}</th>
            <th>{{ "CPU" | translate }}</th>
            <th>{{ "内存" | translate }}</th>
            <th>{{ "IP" | translate }}</th>
            <th>{{ "注册日期" | translate }}</th>
            <th>{{ "更新时间" | translate }}</th>
            <th>{{ "状态" | translate }}</th>
          </tr>
        </thead>
        <tbody>
          {% for one in page_obj %}
          <tr>
            <td>{{ one.rid }}</td>
            <td>{{ one.owner_name|default:one.rust_user|default:"-" }}</td>
            <td>{{ one.device_group_name|default:"-" }}</td>
            <td>{{ one.strategy_name|default:"-" }}</td>
            <td>{{ one.version }}</td>
            <td>{{ one.username }}</td>
            <td>{{ one.hostname }}</td>
            <td>{{ one.os }}</td>
            <td>{{ one.cpu }}</td>
            <td>{{ one.memory }}</td>
            <td>{{ one.ip_address }}</td>
            <td>{{ one.create_time }}</td>
            <td>{{ one.update_time }}</td>
            <td>
              <span class="status-pill {% if one.status == "在线"|translate %}is-online{% else %}is-offline{% endif %}">
                {{ one.status }}
              </span>
            </td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  </div>
</section>
<div class="pagination">
  {% if page_obj.has_previous %}
    <a class="btn btn-ghost" href="?show_type=admin&page=1">&laquo; {{ "首页" | translate }}</a>
    <a class="btn btn-ghost" href="?show_type=admin&page={{ page_obj.previous_page_number }}">{{ "上一页" | translate }}</a>
  {% endif %}
  {% if page_obj.paginator.num_pages > 1 %}
    <span class="page-info">{{ "页码" | translate }} {{ page_obj.number }} / {{ page_obj.paginator.num_pages }}</span>
  {% endif %}
  {% if page_obj.has_next %}
    <a class="btn btn-ghost" href="?show_type=admin&page={{ page_obj.next_page_number }}">{{ "下一页" | translate }}</a>
    <a class="btn btn-ghost" href="?show_type=admin&page={{ page_obj.paginator.num_pages }}">{{ "尾页" | translate }} &raquo;</a>
  {% endif %}
</div>
{% endif %}

{% endblock %}
